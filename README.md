# 이커머스 핵심 모듈 토이 프로젝트

## 📖 개요

### 소개
프로모션, 주문, 결제, 클레임 파트의 미니프로젝트  
### 기술스택
언어 : JAVA 8
프레임워크 : Spring Boot
DB : Postgresql
형상관리 : Git  

## 👓 요구사항
### 프로모션

- 쿠폰 다운로드
- 적용 가능 쿠폰 조회
    - 적용 가능 쿠폰 리스트
    - 각 쿠폰별 혜택 금액
    - 최대혜택가능 쿠폰 Y,N 설정
- 쿠폰 사용 처리
- 쿠폰 복원 처리

### 주문

- 주문 요청 데이터 유효성 체크
- 주문 데이터 등록
- 결제 인터페이스 호출, 프로모션 인터페이스 호출
- 금액 검증

### 결제

- 이니시스 무통장 입금
- 무통장 입금 통보
- 무통장 결제 부분 취소, 전체 취소
- 포인트 결제, 취소

### 클레임

- 주문취소, 교환, 반품 업무
    - 주문취소, 교환접수, 교환철회, 반품접수, 반품철회
- 클레임 요청 데이터 유효성 체크
- 클레임 데이터 등록
- 결제 인터페이스 호출, 프로모션 인터페이스 호출
- 금액 검증

## 🛠️ 설계
## 공통

### 횡단 관심 설정

1. 전체 모듈에 걸쳐 공통적으로 사용되는 로깅 처리를 횡단 관심으로 분리 → Aspect를 생성하여 어노테이션 또는 특정 패키지 기반으로 로그 기록을 남김
2. 데이터 insert, update 시, 공통적으로 insert 또는 update 되어야하는 등록자, 수정자 ID 설정 부분을 횡단 관심으로 분리 → Aspect를 생성하여 어노테이션을 이용하여 등록자, 수정자 ID 설정

### 개발 구조 설계

전략패턴, simple 팩토리 패턴 사용  

## 프로모션
### 🔎 정책

- 쿠폰 다운로드 - 일반쿠폰 다운로드, 오프라인 쿠폰 다운로드
- 쿠폰 적용 - 적용 가능한 쿠폰 종류는 상품 쿠폰, 장바구니 쿠폰
    
    상품 쿠폰의 경우 1개의 상품에만 적용 가능
    
    장바구니 쿠폰의 경우 n개의 상품에 적용 가능
    
- 쿠폰 복원 - 프로모션 기간이 지났을 경우 쿠폰 복원 불가

### 🛠️ 클래스 설계

### 쿠폰 다운로드
![쿠폰 다운로드](https://user-images.githubusercontent.com/52367155/190901091-7f62fd54-2abe-4c73-a0b6-b7add51f5da9.png)


### 쿠폰 적용
![쿠폰적용](https://user-images.githubusercontent.com/52367155/190901087-6a412e64-92a9-4aa2-9885-e23b82cd9908.png)


### 쿠폰 사용/복원
![쿠폰사용취소](https://user-images.githubusercontent.com/52367155/190901086-63b79a35-0e9d-408d-a4d8-9f07438aefd9.png)


### 포인트 적립/사용/복원
![포인트](https://user-images.githubusercontent.com/52367155/190901090-f2f7d50c-ba46-46fd-a3dc-f55b34e8aea4.png)


## 주문결제클레임
## 주문
### 🔎 정책

주문 가능 상품 유형 - 일반상품, 모바일쿠폰

### 🛠️  클래스 설계
![주문 클래스다이어그램](https://user-images.githubusercontent.com/52367155/190901085-1efc3965-8e53-45aa-9509-6b1cd5f6f0ec.PNG)


## 결제
### 🔎 정책

가능한 결제 수단 - 이니시스 가상계좌 입금, 포인트

단일 결제수단으로만 결제 가능

### 🛠️  클래스 설계

### 이니시스/포인트 결제, 취소
![결제](https://user-images.githubusercontent.com/52367155/190901079-c5fecffe-1c1f-4d9d-a095-94b9a4e84bc4.png)


### 이니시스 무통장 입금통보
![입금통보](https://user-images.githubusercontent.com/52367155/190901083-b3d4b5d5-840a-4f7d-9810-bee3747cff24.png)


## 클레임
### 🔎 정책

주문취소 시 클레임 가능 주문상태는 주문대기, 주문완료

반품접수, 교환접수 시 클레임 가능 주문상태는 배송완료

반품철회, 교환철회 시 클레임 가능 주문상태는 반품접수 또는 교환 접수

교환, 반품은 일반상품만 가능 (모바일 쿠폰 불가)

당사사유 반품, 교환시 반품비, 교환비는 무료

고객사유 반품시 반품비 3000원 환불금액에서 차감

고객사유 반품시 반품비 > 반품할 상품금액일 경우 반품비 착불 결제 후 환불

고객사유 교환시 3000원 착불 결제

### 🔎 클레임 상세 프로세스

1. validation 진행
2. 데이터베이스에 insert 또는 update 되어야 할 클레임 데이터 생성
3. insert 또는 update 로직 실행
4. 외부 인터페이스 호출
  - 주문취소완료, 반품완료의 경우 환불을 위해 결제 모듈 호출
  - 주문취소완료, 반품완료의 경우 적용 쿠폰을 있다면 취소 처리를 위해 프로모션 모듈 호출
5. 금액 검증
    - 주문취소완료, 반품완료의 경우 Request로 받은 취소 금액과 실제 환불 금액이 일치하는 지 확인
    - 반품접수, 반품철회, 교환접수, 교환철회의 경우 생성된 클레임 데이터를 기반으로 환불 받을 수 있는 금액과 실제 환불 가능 금액이 일치하는 지 확인
    

### 🛠️  클래스 설계
![클레임](https://user-images.githubusercontent.com/52367155/190901089-e0f5a90a-f8bf-4551-a560-2dacd4b36549.png)


## 모듈 별 연계
### 주문 → 결제, 프로모션

결제 시,  결제 모듈 호출

쿠폰 사용 처리 시, 프로모션 모듈 호출

### 결제 → 프로모션

포인트 결제 시, 포인트 차감을 위해 프로모션 모듈 호출

### 클레임 → 결제, 프로모션

환불 로직 진행 시, 결제 모듈 호출

쿠폰 복원 시, 프로모션 모듈 호출
